/* ===== FORMULARIO GENERAL (look pro con acentos corporativos) ===== */

.form-card{
  background: var(--surface);
  color: var(--text);
  border: 1px solid color-mix(in srgb, var(--brand-1) 18%, var(--border));
  border-radius: 18px;
  box-shadow: var(--shadow-lg);
  padding: 24px;
  background:
    linear-gradient(180deg,
      color-mix(in srgb, var(--brand-1) 4%, transparent) 0%,
      color-mix(in srgb, var(--brand-2) 4%, transparent) 100%);
}

/* ===== Secciones ===== */
.form-section{
  margin: 18px 0;
  border: 1px solid color-mix(in srgb, var(--brand-1) 25%, var(--border));
  border-radius: 14px;
  background:
    linear-gradient(180deg,
      color-mix(in srgb, var(--brand-1) 3%, transparent) 0%,
      color-mix(in srgb, var(--brand-2) 3%, transparent) 100%);
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--border) 80%, transparent);
}

.form-section > legend{
  display: inline-block;
  margin-left: 12px;
  transform: translateY(-12px);
  background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
  color: #fff;
  padding: 8px 16px;
  border-radius: 999px;
  font-weight: 700;
  box-shadow: var(--shadow-md);
  border: 1px solid #ffffff40;
}

/* Espaciado interno */
.form-section > .grid-2,
.form-section > .grid-3,
.form-section > .grid-12,
.form-section > .field,
.form-section > .checks { padding: 14px; }

/* ===== Grid System ===== */
.grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.grid-3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
.grid-12{ display:grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
.grid-span-2{ grid-column: span 2; }
.grid-span-3{ grid-column: span 3; }
.grid-span-4{ grid-column: span 4; }
.grid-span-12{ grid-column: span 12; }

/* ===== Campos ===== */
.field{ display:flex; flex-direction:column; gap:6px; background: color-mix(in srgb, var(--surface) 90%, transparent); border-radius:12px; padding:8px; transition: box-shadow var(--transition-fast) var(--ease-out), background var(--transition-fast) var(--ease-out); }
.field:hover{
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--brand-1) 25%, var(--border));
}
.field label{
  font-weight: 600;
  color: var(--text);
}

.field input,
.field textarea,
.field select{
  border:1px solid var(--border);
  background: var(--surface);
  color: var(--text);
  border-radius: 10px;
  padding:10px 12px;
  width: 100%;
  transition: border-color .15s ease, box-shadow .15s ease;
}
.field input:focus,
.field textarea:focus,
.field select:focus{
  border-color: var(--brand-1);
  box-shadow: 0 0 0 3px var(--focus-ring);
  outline: none;
}

/* Estados de error/invalid accesibles */
.field.error label { color: #b91c1c; }
.field.error input,
.field.error textarea,
.field.error select,
.field input.error,
.field textarea.error,
.field select.error{
  border-color: #ef4444;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, .2);
}
.field .error-text { color: #b91c1c; font-size: .85rem; }

/* textarea controlado */
.field textarea{
  resize: vertical;
  min-height: 90px;
  max-height: 420px;
}

/* ===== Radios y Checks ===== */
.inline-controls{
  display:flex;
  gap:14px;
  align-items:center;
  flex-wrap:wrap;
}
.inline-controls input[type="radio"],
.inline-controls input[type="checkbox"]{
  accent-color: var(--brand-1);
}
.inline-controls label{ font-weight:600; }

.checks{ display:flex; flex-wrap:wrap; gap:14px; }

/* ===== Etiquetas pequeñas ===== */
.badge{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  font-size:.75rem;
  background:#eef2ff;
  color:#334155;
  border:1px solid #c7d2fe;
  margin-left:6px;
  font-weight: 600;
}

.badge.success{
  background: #dcfce7;
  color: #166534;
  border-color: #86efac;
}

.badge.warning{
  background: #fef3c7;
  color: #92400e;
  border-color: #fcd34d;
}

.badge.danger{
  background: #fee2e2;
  color: #991b1b;
  border-color: #fca5a5;
}

/* ===== Botones ===== */
.form-actions{
  position: sticky;
  bottom: 10px;
  z-index: 2;
  margin-top: 18px;
  display:flex;
  align-items:center;
  gap:10px;
  padding: 12px;
  background: color-mix(in srgb, var(--surface) 88%, transparent);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: 0 10px 28px rgba(0,0,0,.12);
  backdrop-filter: saturate(120%) blur(6px);
}

.btn{
  appearance:none;
  border-radius:12px;
  padding:10px 16px;
  font-weight:700;
  display:inline-flex;
  align-items:center;
  gap:8px;
  border:1px solid transparent;
  cursor:pointer;
  transition: transform .1s ease, box-shadow .1s ease, filter .1s ease;
}
.btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
.btn:active{ transform: translateY(0); }
.btn:focus-visible{ outline: none; box-shadow: 0 0 0 3px var(--focus-ring); }
.btn:disabled{ opacity: .6; cursor: not-allowed; filter: none; transform:none; }

.btn.primary{
  background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
  color:#fff;
  border:0;
}
.btn.light{
  background:#fff;
  color:var(--text);
  border:1px solid var(--border);
}
.btn.ghost{
  background:transparent;
  border:1px dashed var(--border);
  color:var(--text);
}
.btn.pdf{
  background:#fff;
  border:1px solid var(--border);
}
.btn.pdf:hover{
  box-shadow: 0 0 0 3px var(--focus-ring);
}
.btn.secondary{
  background: var(--surface);
  color: var(--text);
  border: 1px solid var(--border);
}
.btn.danger{
  background: linear-gradient(135deg, #dc2626, #991b1b);
  color: #fff;
  border: 0;
}

/* Spinner para botones con estado de carga */
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ===== Mensajes de error ===== */
.err{ color:#b91c1c; font-weight:600; }
.error-text{ 
  color: #b91c1c; 
  font-weight: 600; 
  display: block;
  margin-top: 4px;
  font-size: 0.875rem;
}
.helper-text{
  color: var(--text-secondary);
  display: block;
  margin-top: 4px;
  font-size: 0.875rem;
}
.required{
  color: #dc2626;
  font-weight: 700;
}

/* ===== Responsive ===== */
@media (max-width: 900px){
  .grid-2, .grid-3{ grid-template-columns: 1fr; }
  .grid-span-2, .grid-span-3, .grid-span-4{ grid-column: auto; }
  .form-actions{ position: static; box-shadow:none; }
}

/* ===== CONFIG. DE HOJA IMPRIMIBLE ===== */

/* ancho visual estilo A4 en pantalla (centrado); en impresión lo ajustamos de nuevo */
.print-sheet{
  max-width: 190mm; /* ~A4 menos márgenes */
  margin-inline: auto;
}

/* Compactación general cuando queremos forzar todo en una sola hoja */
html.print-one {
  /* reduce tipografía, gaps y paddings en toda la app durante la impresión */
  --compact-scale: 0.86;     /* puedes subir/bajar este valor */
  --compact-gap: 8px;

  font-size: calc(16px * var(--compact-scale));
}

html.print-one .form-card{ padding: 12px; }
html.print-one .form-section{ margin: 10px 0; }
html.print-one .grid-2,
html.print-one .grid-3,
html.print-one .grid-12{ gap: var(--compact-gap); }
html.print-one .field{ padding: 6px; }
html.print-one .field input,
html.print-one .field textarea,
html.print-one .field select{ padding: 8px 10px; }

/* =========================
   IMPRESIÓN SIN RESPONSIVE
   ========================= */
@media print {
  /* Hoja A4 vertical y márgenes del documento */
  @page { size: A4 portrait; margin: 10mm; }

  html, body {
    width: 210mm;        /* ancho A4 */
    margin: 0;
    background: #fff !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    font-size: 11pt;     /* tipografía legible, estable */
    line-height: 1.3;
  }

  /* Oculta UI no necesaria en PDF */
  .navbar, .navbar-toggle, .mobile-panel,
  .form-actions, .btn, .theme-btn { display: none !important; }

  /* Contenido centrado estilo “hoja” */
  .container, .print-sheet {
    max-width: 190mm !important;  /* aprovecha el ancho A4 */
    width: 100% !important;
    padding: 0 !important;
    margin: 0 auto !important;
  }

  /* Quita sombras/blur para evitar “bordes” y ahorrar espacio */
  .form-card, .card {
    box-shadow: none !important; /* sin bordes oscuros en PDF */
    /* mantener el background original del tema */
    border-color: color-mix(in srgb, var(--border) 80%, transparent) !important;
  }

  /* ▸ DESACTIVAR responsive: fuerzo los grids de escritorio */
  .grid-2 { grid-template-columns: 1fr 1fr !important; gap: 8pt !important; }
  .grid-3 { grid-template-columns: 1fr 1fr 1fr !important; gap: 8pt !important; }
  .grid-12{ grid-template-columns: repeat(12, 1fr) !important; gap: 8pt !important; }

  /* Si en móvil tenías overrides, los anulamos aquí */
  @media (max-width: 900px) {
    .grid-2, .grid-3, .grid-12 { gap: 8pt !important; }
  }

  /* Inputs/labels compactos (sin perder legibilidad) */
  .field { gap: 4pt !important; padding: 0 !important; }
  .field label { font-weight: 600; }
  .field input, .field textarea, .field select {
    padding: 6pt 8pt !important;
    border-radius: 6pt !important;
    font-size: 11pt !important;
  }

  /* Legend/chip en impresión: evitar recorte en salto de página */
  .form-section > legend {
    transform: none !important;
    position: static !important;
    margin: 0 0 6pt 0 !important;
    padding: 4pt 10pt !important;
    border-radius: 12pt !important;
    display: inline-block !important;
  }

  /* ============================
     Agrupar 3 secciones por hoja
     ============================ */
  .form-card > .form-section { break-inside: avoid; page-break-inside: avoid; padding-top: 6pt; }
  /* Salto antes de la 4ª, 7ª, 10ª ... sección */
  .form-card > .form-section:nth-of-type(3n+4) {
    break-before: page; page-break-before: always;
    margin-top: 0 !important; /* evita margen colapsado en top de página */
    padding-top: 8pt !important; /* espacio para el legend sin recorte */
  }

  /* ============================
     Sistema eléctrico (alineación)
     ============================ */
  .form-section.electrico-section .grid-12 {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important; /* 3 columnas balanceadas */
    gap: 6pt !important;
  }
  /* Ignorar spans para que los ítems fluyan y llenen columnas */
  .form-section.electrico-section .grid-span-3,
  .form-section.electrico-section .grid-span-4,
  .form-section.electrico-section .grid-span-12 { grid-column: auto !important; }

  .form-section.electrico-section .inline-controls { gap: 8pt !important; flex-wrap: wrap; }
  .form-section.electrico-section .inline-controls label { display: inline-flex; align-items: center; gap: 4pt; }
  .form-section.electrico-section .field { min-height: auto !important; padding: 0 !important; }

  /* Evitar cortes feos: intentamos no partir secciones */
  .form-section, .card { break-inside: avoid; page-break-inside: avoid; }
  .form-section > legend {
    color: #000 !important;
    background: #fff !important;
    border: 1px solid #000 !important;
    border-radius: 12pt !important;
    padding: 4pt 10pt !important;
  }

  /* Imágenes/previews de fotos: cuadrícula estable en impresión */
  .preview-grid {
    grid-template-columns: repeat(3, 1fr) !important; /* 3 por fila en A4 */
    gap: 6pt !important;
  }
  .preview-item { aspect-ratio: 1/1; border-color: #cfd8e3 !important; }

  /* Elimina cualquier “responsive” que esconda el menú de escritorio */
  .navbar-menu { display: none !important; }
}

/* ========== ImagePicker ========== */
.image-picker { 
  display: grid; 
  gap: 8px; 
  max-width: 100%; 
  overflow: hidden;
}
.picker-label { font-weight: 600; color: var(--text); }

.picker-row { display: flex; gap: 10px; align-items: center; }

/* Botón vistoso */
.picker-btn {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 10px 14px; border-radius: 12px; cursor: pointer;
  border: 1px dashed var(--border);
  background: var(--surface); color: var(--text);
  transition: box-shadow .15s ease, transform .12s ease, border-color .15s ease;
}
.picker-btn:hover { box-shadow: var(--focus); transform: translateY(-1px); border-color: var(--brand-1); }
.picker-icon { font-size: 1.1rem; }

/* Ocultamos input nativo */
.picker-input-hidden { display: none; }

/* Rejilla de miniaturas */
.preview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 8px;
  max-width: 100%;
}
.preview-item {
  position: relative;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: var(--shadow-1);
  max-width: 100%;
  /* Micro elevación al pasar el mouse */
  transition: transform var(--transition-fast) var(--ease-out), box-shadow var(--transition-fast) var(--ease-out);
}
.preview-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.preview-item img {
  width: 100%; height: 90px; object-fit: cover; display: block;
}

/* Overlay para garantizar contraste de texto sobre la imagen */
.preview-item::after{
  content: "";
  position:absolute; inset:0; pointer-events:none;
  background: linear-gradient(to top, rgba(0,0,0,.45), rgba(0,0,0,.0) 60%);
  opacity: .85;
  transition: opacity var(--transition-fast) var(--ease-out);
}
.preview-item:hover::after{ opacity: 1; }

.preview-item figcaption {
  position: absolute; left: 0; right: 0; bottom: 0;
  font-size: .78rem; padding: 6px 8px;
  color: #fff;
  text-shadow: 0 1px 2px rgba(0,0,0,.5);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

/* Botón de quitar miniatura */
.preview-remove {
  position: absolute; top: 6px; right: 6px;
  border: 0; border-radius: 999px; width: 24px; height: 24px;
  display: grid; place-items: center; cursor: pointer;
  background: rgba(0,0,0,.5); color: #fff;
}
.preview-remove:hover { background: rgba(0,0,0,.65); }

/* En impresión, 3 por fila con correcciones para visualización correcta */
@media print {
  /* Evita que el registro fotográfico se corte entre páginas */
  .image-picker,
  .preview-grid {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    -webkit-column-break-inside: avoid !important;
  }

  /* Layout de miniaturas: grid con tamaño fijo para impresión */
  .preview-grid {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 6pt !important;
    align-items: start !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 6pt !important;
  }

  /* Contenedor de cada miniatura: tamaño reducido para evitar desbordamiento */
  .preview-item {
    display: block !important;
    width: 100% !important;
    height: 70pt !important;  /* tamaño reducido para caber en página */
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
    aspect-ratio: auto !important;
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    box-shadow: none !important;
    border-radius: 4pt !important;
  }

  /* Imagen llena el contenedor manteniendo proporción */
  .preview-item img {
    width: 100% !important;
    height: 100% !important;
    max-width: 100% !important;
    object-fit: cover !important;
    display: block !important;
    transform: none !important;
  }
  
  /* Ocultar caption en impresión para ahorrar espacio */
  .preview-item figcaption {
    display: none !important;
  }

  /* Quitar overlay en impresión para evitar franjas oscuras */
  .preview-item::after { display: none !important; }

  /* Ocultar botones de control en impresión */
  .preview-remove,
  .picker-btn,
  .picker-row {
    display: none !important;
  }

  /* Ajustar márgenes de página para ganar espacio */
  @page {
    margin: 12mm 10mm !important;
  }
}

/* ===== Tema oscuro: sutiles ajustes de contraste ===== */
[data-theme="dark"] .form-card{
  border-color: color-mix(in srgb, var(--brand-1) 25%, var(--border));
  box-shadow: var(--shadow-md);
}
[data-theme="dark"] .form-section{
  border-color: color-mix(in srgb, var(--brand-1) 35%, var(--border));
}
[data-theme="dark"] .preview-item{
  border-color: color-mix(in srgb, #ffffff 8%, var(--border));
}


