<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Plan de Trabajo - {{workPlan.id}}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      font-size: 11pt;
      line-height: 1.6;
      color: #333;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 3px solid #003d7a;
      padding-bottom: 15px;
      margin-bottom: 30px;
    }

    .logo {
      width: 150px;
      height: auto;
    }

    .company-info {
      text-align: right;
      font-size: 9pt;
      color: #666;
    }

    .company-info strong {
      color: #003d7a;
      font-size: 14pt;
    }

    h1 {
      text-align: center;
      color: #003d7a;
      font-size: 18pt;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 10pt;
      margin-bottom: 30px;
    }

    .status-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 15px;
      font-size: 10pt;
      font-weight: bold;
      text-transform: uppercase;
    }

    .status-draft {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .status-approved {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-rejected {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .section {
      margin-bottom: 25px;
      page-break-inside: avoid;
    }

    .section-title {
      background-color: #003d7a;
      color: white;
      padding: 8px 12px;
      font-size: 12pt;
      font-weight: bold;
      margin-bottom: 15px;
      border-radius: 3px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 20px;
      margin-bottom: 15px;
    }

    .info-item {
      display: flex;
      padding: 8px;
      background-color: #f5f5f5;
      border-radius: 3px;
    }

    .info-label {
      font-weight: bold;
      color: #003d7a;
      min-width: 140px;
    }

    .info-value {
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      font-size: 10pt;
    }

    table th {
      background-color: #003d7a;
      color: white;
      padding: 10px;
      text-align: left;
      font-weight: bold;
    }

    table td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }

    table tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .materials-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
    }

    .material-card {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      background-color: #fafafa;
    }

    .material-name {
      font-weight: bold;
      color: #003d7a;
      margin-bottom: 8px;
    }

    .material-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      font-size: 9pt;
    }

    .material-detail {
      display: flex;
      justify-content: space-between;
    }

    .material-label {
      color: #666;
    }

    .material-value {
      font-weight: bold;
    }

    .timeline {
      position: relative;
      padding-left: 30px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: #003d7a;
    }

    .timeline-item {
      position: relative;
      margin-bottom: 20px;
      padding-left: 20px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -22px;
      top: 8px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #003d7a;
    }

    .timeline-date {
      font-weight: bold;
      color: #003d7a;
      font-size: 10pt;
    }

    .timeline-content {
      margin-top: 5px;
      padding: 10px;
      background-color: #f5f5f5;
      border-radius: 3px;
      font-size: 9pt;
    }

    .budget-summary {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 15px;
      margin: 20px 0;
    }

    .budget-card {
      text-align: center;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      background-color: #fafafa;
    }

    .budget-label {
      font-size: 10pt;
      color: #666;
      margin-bottom: 8px;
    }

    .budget-amount {
      font-size: 16pt;
      font-weight: bold;
      color: #003d7a;
    }

    .notes-section {
      background-color: #fffbeb;
      border-left: 4px solid #fbbf24;
      padding: 15px;
      margin: 20px 0;
      border-radius: 3px;
    }

    .notes-title {
      font-weight: bold;
      color: #d97706;
      margin-bottom: 8px;
    }

    .approval-section {
      background-color: #f0f9ff;
      border: 2px solid #0ea5e9;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }

    .approval-title {
      font-weight: bold;
      color: #0ea5e9;
      margin-bottom: 15px;
      text-align: center;
    }

    .approval-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .approval-item {
      text-align: center;
    }

    .approval-label {
      font-size: 10pt;
      color: #666;
      margin-bottom: 5px;
    }

    .approval-value {
      font-weight: bold;
      color: #003d7a;
    }

    .footer {
      margin-top: 50px;
      padding-top: 20px;
      border-top: 2px solid #ddd;
      text-align: center;
      font-size: 9pt;
      color: #666;
    }

    .signature-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-top: 60px;
    }

    .signature-box {
      text-align: center;
    }

    .signature-line {
      border-top: 2px solid #333;
      margin-top: 80px;
      padding-top: 10px;
    }

    .signature-name {
      font-weight: bold;
      color: #003d7a;
    }

    .signature-role {
      font-size: 9pt;
      color: #666;
    }

    @media print {
      body {
        padding: 0;
      }

      .section {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div>
      <img src="data:image/png;base64,{{logoBase64}}" alt="CERMONT S.A.S." class="logo">
    </div>
    <div class="company-info">
      <strong>CERMONT S.A.S.</strong><br>
      NIT: 901.234.567-8<br>
      Arauca, Colombia<br>
      Tel: +57 300 123 4567
    </div>
  </div>

  <!-- Title -->
  <h1>Plan de Trabajo</h1>
  <div class="subtitle">
    ID: <strong>{{workPlan.id}}</strong> |
    Estado: <span class="status-badge status-{{workPlan.status.toLowerCase()}}">{{workPlan.status}}</span> |
    Fecha: <strong>{{formatDate generatedAt}}</strong>
  </div>

  <!-- Información General -->
  <div class="section">
    <div class="section-title">1. INFORMACIÓN GENERAL</div>
    <div class="info-grid">
      <div class="info-item">
        <span class="info-label">Orden de Trabajo:</span>
        <span class="info-value">{{workPlan.orderId}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Cliente:</span>
        <span class="info-value">{{workPlan.clientName}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Ubicación:</span>
        <span class="info-value">{{workPlan.location}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Fecha Creación:</span>
        <span class="info-value">{{formatDate workPlan.createdAt}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Técnico Responsable:</span>
        <span class="info-value">{{workPlan.technicianName}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Prioridad:</span>
        <span class="info-value">{{workPlan.priority}}</span>
      </div>
    </div>
    <div class="info-item" style="grid-column: 1 / -1;">
      <span class="info-label">Descripción del Trabajo:</span>
      <span class="info-value">{{workPlan.description}}</span>
    </div>
  </div>

  <!-- Cronograma -->
  <div class="section">
    <div class="section-title">2. CRONOGRAMA DE EJECUCIÓN</div>
    <div class="info-grid">
      <div class="info-item">
        <span class="info-label">Fecha Inicio Planificada:</span>
        <span class="info-value">{{formatDate workPlan.plannedStart}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Fecha Fin Planificada:</span>
        <span class="info-value">{{formatDate workPlan.plannedEnd}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Duración Estimada:</span>
        <span class="info-value">{{workPlan.estimatedHours}} horas</span>
      </div>
      <div class="info-item">
        <span class="info-label">Fecha Inicio Real:</span>
        <span class="info-value">{{#if workPlan.actualStart}}{{formatDate workPlan.actualStart}}{{else}}Pendiente{{/if}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Fecha Fin Real:</span>
        <span class="info-value">{{#if workPlan.actualEnd}}{{formatDate workPlan.actualEnd}}{{else}}Pendiente{{/if}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Horas Reales:</span>
        <span class="info-value">{{#if workPlan.actualHours}}{{workPlan.actualHours}} horas{{else}}Pendiente{{/if}}</span>
      </div>
    </div>
  </div>

  <!-- Presupuesto -->
  <div class="section">
    <div class="section-title">3. PRESUPUESTO Y COSTOS</div>
    <div class="budget-summary">
      <div class="budget-card">
        <div class="budget-label">PRESUPUESTO ESTIMADO</div>
        <div class="budget-amount">{{formatCurrency workPlan.estimatedBudget}}</div>
      </div>
      <div class="budget-card">
        <div class="budget-label">COSTO MATERIALES</div>
        <div class="budget-amount">{{formatCurrency materialsTotal}}</div>
      </div>
      <div class="budget-card">
        <div class="budget-label">COSTO MANO DE OBRA</div>
        <div class="budget-amount">{{formatCurrency workPlan.laborCost}}</div>
      </div>
    </div>
  </div>

  <!-- Materiales Requeridos -->
  {{#if workPlan.materials}}
  <div class="section">
    <div class="section-title">4. MATERIALES REQUERIDOS</div>
    <div class="materials-grid">
      {{#each workPlan.materials}}
      <div class="material-card">
        <div class="material-name">{{this.name}}</div>
        <div class="material-details">
          <div class="material-detail">
            <span class="material-label">Cantidad:</span>
            <span class="material-value">{{this.quantity}} {{this.unit}}</span>
          </div>
          <div class="material-detail">
            <span class="material-label">Costo Unitario:</span>
            <span class="material-value">{{formatCurrency this.unitCost}}</span>
          </div>
          <div class="material-detail">
            <span class="material-label">Costo Total:</span>
            <span class="material-value">{{formatCurrency (multiply this.quantity this.unitCost)}}</span>
          </div>
          <div class="material-detail">
            <span class="material-label">Estado:</span>
            <span class="material-value">Pendiente</span>
          </div>
        </div>
      </div>
      {{/each}}
    </div>
  </div>
  {{/if}}

  <!-- Equipos y Herramientas -->
  {{#if workPlan.tools}}
  <div class="section">
    <div class="section-title">5. EQUIPOS Y HERRAMIENTAS</div>
    <table>
      <thead>
        <tr>
          <th style="width: 70%;">Equipo/Herramienta</th>
          <th style="width: 15%; text-align: center;">Cantidad</th>
          <th style="width: 15%; text-align: center;">Estado</th>
        </tr>
      </thead>
      <tbody>
        {{#each workPlan.tools}}
        <tr>
          <td>{{this}}</td>
          <td style="text-align: center;">1</td>
          <td style="text-align: center;">? Verificado</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  {{/if}}

  <!-- EPP Requerido -->
  {{#if workPlan.ppe}}
  <div class="section">
    <div class="section-title">6. EQUIPO DE PROTECCIÓN PERSONAL (EPP)</div>
    <table>
      <thead>
        <tr>
          <th style="width: 80%;">Elemento de Protección</th>
          <th style="width: 20%; text-align: center;">Verificado</th>
        </tr>
      </thead>
      <tbody>
        {{#each workPlan.ppe}}
        <tr>
          <td>{{this}}</td>
          <td style="text-align: center;">?</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  {{/if}}

  <!-- Análisis de Trabajo Seguro (AST) -->
  {{#if workPlan.asts}}
  <div class="section">
    <div class="section-title">7. ANÁLISIS DE TRABAJO SEGURO (AST)</div>
    <div style="display: grid; gap: 15px;">
      {{#each workPlan.asts}}
      <div style="border: 2px solid #ff9800; border-radius: 5px; padding: 15px; background-color: #fff3e0;">
        <div style="font-weight: bold; color: #d32f2f; margin-bottom: 10px;">Actividad: {{this.activity}}</div>

        <div style="margin: 8px 0;">
          <div style="font-weight: bold; color: #ff9800; margin-bottom: 5px;">Riesgos Identificados:</div>
          <ul style="padding-left: 15px; margin: 0;">
            {{#each this.risks}}
            <li>{{this}}</li>
            {{/each}}
          </ul>
        </div>

        <div style="margin: 8px 0;">
          <div style="font-weight: bold; color: #ff9800; margin-bottom: 5px;">Controles Aplicados:</div>
          <ul style="padding-left: 15px; margin: 0;">
            {{#each this.controls}}
            <li>{{this}}</li>
            {{/each}}
          </ul>
        </div>
      </div>
      {{/each}}
    </div>
  </div>
  {{/if}}

  <!-- Notas y Observaciones -->
  {{#if workPlan.notes}}
  <div class="section">
    <div class="notes-section">
      <div class="notes-title">?? NOTAS Y OBSERVACIONES</div>
      <p>{{workPlan.notes}}</p>
    </div>
  </div>
  {{/if}}

  <!-- Información de Aprobación -->
  {{#if workPlan.status}}
  <div class="section">
    <div class="approval-section">
      <div class="approval-title">?? INFORMACIÓN DE APROBACIÓN</div>
      <div class="approval-grid">
        <div class="approval-item">
          <div class="approval-label">Estado del Plan:</div>
          <div class="approval-value">{{workPlan.status}}</div>
        </div>
        {{#if workPlan.approvedBy}}
        <div class="approval-item">
          <div class="approval-label">Aprobado Por:</div>
          <div class="approval-value">{{workPlan.approvedBy}}</div>
        </div>
        <div class="approval-item">
          <div class="approval-label">Fecha de Aprobación:</div>
          <div class="approval-value">{{formatDate workPlan.approvedAt}}</div>
        </div>
        {{#if workPlan.approvalComments}}
        <div class="approval-item">
          <div class="approval-label">Comentarios:</div>
          <div class="approval-value">{{workPlan.approvalComments}}</div>
        </div>
        {{/if}}
        {{else if workPlan.rejectedBy}}
        <div class="approval-item">
          <div class="approval-label">Rechazado Por:</div>
          <div class="approval-value">{{workPlan.rejectedBy}}</div>
        </div>
        <div class="approval-item">
          <div class="approval-label">Fecha de Rechazo:</div>
          <div class="approval-value">{{formatDate workPlan.rejectedAt}}</div>
        </div>
        <div class="approval-item">
          <div class="approval-label">Motivo de Rechazo:</div>
          <div class="approval-value">{{workPlan.rejectionReason}}</div>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
  {{/if}}

  <!-- Firmas -->
  <div class="signature-section">
    <div class="signature-box">
      <div class="signature-line">
        <div class="signature-name">{{workPlan.technicianName}}</div>
        <div class="signature-role">Técnico Responsable</div>
        <div class="signature-role">Fecha: {{formatDate generatedAt}}</div>
      </div>
    </div>
    <div class="signature-box">
      <div class="signature-line">
        <div class="signature-name">___________________________</div>
        <div class="signature-role">Supervisor de Proyectos</div>
        <div class="signature-role">Fecha: _______________</div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>Este documento fue generado automáticamente por el Sistema de Gestión CERMONT</p>
    <p>Fecha de generación: {{formatDate generatedAt}} | Hora: {{formatTime generatedAt}}</p>
  </div>
</body>
</html>