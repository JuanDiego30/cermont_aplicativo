// ============================================
// MANTENIMIENTOS
// ============================================

model Equipo {
  id                         String        @id @default(uuid())
  codigo                     String        @unique
  nombre                     String
  marca                      String?
  modelo                     String?
  serie                      String?
  categoria                  String?
  ubicacion                  String?
  
  fechaAdquisicion           DateTime?
  fechaUltimoMantenimiento   DateTime?
  intervaloMantenimientoDias Int?
  proximoMantenimiento       DateTime?
  
  valorAdquisicion           Float?
  vidaUtilEstimada           Int?
  
  activo                     Boolean       @default(true)
  notas                      String?

  creadoPorId                String?
  
  creadoPor                  User?         @relation("EquipoCreador", fields: [creadoPorId], references: [id], onDelete: SetNull)
  // Relación inversa comentada o eliminada si ya no se usa directamente,
  // pero como Mantenimiento ahora usa activoId genérico, no hay relación directa @relation en Prisma
  // a menos que mantengamos un campo equipoId opcional o definamos una relación polimórfica (que Prisma no soporta nativamente bien).
  // Para este refactor se pidió usar activoId (String). 
  // Sin embargo, para mantener integridad referencial si es un Equipo, podríamos dejarlo opcional o solo manejarlo por ID.
  // EL USUARIO PIDIÓ: activoId: string.
  
  createdAt                  DateTime      @default(now())
  updatedAt                  DateTime      @updatedAt

  @@index([codigo])
  @@index([activo])
  @@index([categoria])
  @@index([proximoMantenimiento])
  @@map("equipos")
}

model Mantenimiento {
  id                   String                 @id @default(uuid())

  titulo               String
  descripcion          String?
  
  tipo                 TipoMantenimiento
  estado               EstadoMantenimiento    @default(programado)
  prioridad            PrioridadMantenimiento @default(media)
  periodicidad         MantenimientoPeriodicidad @default(NO_APLICA)

  // Programación
  fechaProgramada      DateTime
  duracionEstimada     Float?                 // Horas

  // Ejecución
  fechaInicio          DateTime?
  fechaFin             DateTime?
  
  // Activo (Polimórfico lógico)
  activoId             String
  activoTipo           String?                // 'equipo', 'orden', 'linea_vida', etc.

  // Recursos Asignados
  tecnicoId            String?
  tecnico              User?                  @relation("MantenimientosTecnico", fields: [tecnicoId], references: [id], onDelete: SetNull)

  // Detalles
  tareas               String[]               @default([])
  materiales           String[]               @default([])
  observaciones        String?

  // Resultados
  trabajoRealizado     String?
  tareasCompletadas    String[]               @default([])
  problemasEncontrados String[]               @default([])
  repuestosUtilizados  String[]               @default([])
  
  completado           Boolean                @default(false)
  requiereSeguimiento  Boolean                @default(false)
  calificacionFinal    Float?                 // 0-10
  recomendaciones      String?
  evidenciaIds         String[]               @default([])

  // Costos
  costoTotal           Float?

  creadoPorId          String?
  creadoPor            User?                  @relation("MantenimientosCreador", fields: [creadoPorId], references: [id], onDelete: SetNull)

  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt

  @@index([activoId])
  @@index([estado])
  @@index([fechaProgramada])
  @@index([tecnicoId])
  @@index([prioridad, estado])
  @@map("mantenimientos")
}
