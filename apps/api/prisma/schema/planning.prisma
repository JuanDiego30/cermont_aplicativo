// ============================================
// PLANEACIÓN Y KITS TÍPICOS
// ============================================

model KitTipico {
  id                    String      @id @default(uuid())
  nombre                String      @unique
  codigo                String?
  descripcion           String
  categoria             String?
  herramientas          Json
  equipos               Json
  materiales            Json?
  documentos            String[]
  checklistItems        String[]
  duracionEstimadaHoras Int
  costoEstimado         Float
  activo                Boolean     @default(true)

  creadoPorId           String?

  planeaciones          Planeacion[]

  creadoPor             User?       @relation("KitCreador", fields: [creadoPorId], references: [id], onDelete: SetNull)

  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt

  @@index([activo, categoria])
  @@index([codigo])
  @@map("kits_tipicos")
}

model Planeacion {
  id                      String            @id @default(uuid())
  estado                  EstadoPlaneacion  @default(borrador)

  empresa                 String?
  ubicacion               String?
  fechaEstimadaInicio     DateTime?
  fechaEstimadaFin        DateTime?
  descripcionTrabajo      String?

  cronograma              Json
  manoDeObra              Json
  herramientasAdicionales Json?
  materialesAdicionales   Json?
  documentosApoyo         String[]
  observaciones           String?

  motivoRechazo           String?
  rechazadoEn             DateTime?
  rechazadoPorId          String?

  aprobadoPorId           String?
  fechaAprobacion         DateTime?

  ordenId                 String            @unique
  kitId                   String?
  creadoPorId             String?

  orden                   Order             @relation(fields: [ordenId], references: [id], onDelete: Cascade)
  kit                     KitTipico?        @relation(fields: [kitId], references: [id], onDelete: SetNull)
  aprobadoPor             User?             @relation("PlaneacionAprobador", fields: [aprobadoPorId], references: [id], onDelete: SetNull)
  rechazadoPor            User?             @relation("PlaneacionRechazador", fields: [rechazadoPorId], references: [id], onDelete: SetNull)
  creadoPor               User?             @relation("PlaneacionCreador", fields: [creadoPorId], references: [id], onDelete: SetNull)

  ejecucion               Ejecucion?
  items                   ItemPlaneacion[]

  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt

  @@index([estado])
  @@index([kitId])
  @@index([aprobadoPorId])
  @@map("planeaciones")
}

model ItemPlaneacion {
  id            String     @id @default(uuid())
  planeacionId  String
  tipo          String
  descripcion   String
  cantidad      Int        @default(1)
  unidad        String     @default("UND")
  observaciones String?

  planeacion    Planeacion @relation(fields: [planeacionId], references: [id], onDelete: Cascade)

  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([planeacionId])
  @@index([tipo])
  @@map("items_planeacion")
}
