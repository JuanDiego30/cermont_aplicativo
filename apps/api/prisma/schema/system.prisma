// ============================================
// SISTEMA - NOTIFICACIONES Y ARCHIVOS
// ============================================

model PushSubscription {
  id        String   @id @default(uuid())
  userId    String
  endpoint  String   @unique
  auth      String
  p256dh    String
  deviceId  String?
  activa    Boolean  @default(true)
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, activa])
  @@map("push_subscriptions")
}

// ============================================
// ARCHIVO HISTÓRICO
// ============================================

model ArchivoHistorico {
  id   String      @id @default(uuid())
  tipo TipoArchivo

  mes  Int
  anio Int

  nombreArchivo String
  rutaArchivo   String
  tamanioBytes  BigInt

  cantidadOrdenes    Int     @default(0)
  cantidadEvidencias Int     @default(0)
  descripcion        String?

  disponible    Boolean   @default(true)
  descargado    Boolean   @default(false)
  fechaDescarga DateTime?

  creadoPorId    String?
  creadoPor      User?    @relation("ArchivoCreador", fields: [creadoPorId], references: [id], onDelete: SetNull)
  fechaArchivado DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([mes, anio, tipo])
  @@index([mes, anio])
  @@index([disponible])
  @@index([creadoPorId])
  @@map("archivos_historicos")
}

// ============================================
// SINCRONIZACIÓN OFFLINE
// ============================================

model PendingSync {
  id         String   @id @default(uuid())
  userId     String
  deviceId   String?
  entityType String
  entityId   String?
  action     String
  data       Json?
  localId    String?
  timestamp  DateTime
  status     String   @default("pending")
  error      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@map("pending_syncs")
}
