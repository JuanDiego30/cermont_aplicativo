// ============================================
// HES - SEGURIDAD EN ALTURAS
// ============================================

model EquipoHES {
  id                String          @id @default(uuid())
  numero            String          @unique
  codigo            String?
  marca             String
  modelo            String?
  tipo              String
  estado            String          @default("disponible")
  
  fechaCompra       DateTime?
  fechaFabricacion  DateTime?
  vidaUtilAnios     Int?
  
  ultimaInspeccion  DateTime?
  proximaInspeccion DateTime?

  especificaciones  Json?
  observaciones     String?

  inspecciones      InspeccionHES[]
  ordenes           OrdenEquipoHES[]

  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@index([estado])
  @@index([tipo])
  @@index([proximaInspeccion])
  @@map("equipos_hes")
}

model InspeccionHES {
  id              String          @id @default(uuid())

  equipoId        String
  inspectorId     String
  ordenId         String?

  fechaInspeccion DateTime        @default(now())
  estado          String
  observaciones   String?
  fotosEvidencia  String[]
  
  aprobada        Boolean         @default(false)
  aprobadaEn      DateTime?

  equipo          EquipoHES       @relation(fields: [equipoId], references: [id], onDelete: Restrict)
  inspector       User            @relation("InspectorHES", fields: [inspectorId], references: [id], onDelete: Restrict)
  orden           Order?          @relation(fields: [ordenId], references: [id], onDelete: SetNull)

  items           InspeccionItem[]

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([equipoId, fechaInspeccion(sort: Desc)])
  @@index([inspectorId])
  @@index([ordenId])
  @@index([estado])
  @@map("inspecciones_hes")
}

model InspeccionItem {
  id           String        @id @default(uuid())

  inspeccionId String
  rubro        String
  descripcion  String?
  estado       String
  conforme     Boolean       @default(true)
  notas        String?

  inspeccion   InspeccionHES @relation(fields: [inspeccionId], references: [id], onDelete: Cascade)

  @@index([inspeccionId])
  @@map("inspeccion_items")
}

model OrdenEquipoHES {
  id        String    @id @default(uuid())
  ordenId   String
  equipoId  String

  cantidad  Int       @default(1)
  estado    String    @default("asignado")
  
  fechaAsignacion DateTime @default(now())
  fechaDevolucion DateTime?
  observaciones   String?

  orden     Order     @relation(fields: [ordenId], references: [id], onDelete: Cascade)
  equipo    EquipoHES @relation(fields: [equipoId], references: [id], onDelete: Restrict)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([ordenId, equipoId])
  @@index([ordenId])
  @@index([equipoId])
  @@index([estado])
  @@map("orden_equipos_hes")
}

// ============================================
// INSPECCIÓN LÍNEAS DE VIDA
// ============================================

model InspeccionLineaVida {
  id                       String           @id @default(uuid())
  numeroLinea              String           @unique
  fabricante               String
  diametroCable            String           @default("8mm")
  tipoCable                String           @default("Acero Inoxidable")
  ubicacion                String
  especificaciones         Json?

  fechaInspeccion          DateTime         @default(now())
  fechaInstalacion         DateTime?
  fechaUltimoMantenimiento DateTime?
  proximaInspeccion        DateTime?

  estado                   EstadoInspeccion @default(pendiente)
  accionesCorrectivas      String?
  observaciones            String?
  fotosEvidencia           String[]

  inspectorId              String
  
  inspector                User                  @relation("InspectorLineaVida", fields: [inspectorId], references: [id], onDelete: Restrict)
  componentes              ComponenteLineaVida[]

  createdAt                DateTime         @default(now())
  updatedAt                DateTime         @updatedAt

  @@index([numeroLinea])
  @@index([inspectorId])
  @@index([estado])
  @@index([proximaInspeccion])
  @@map("inspecciones_linea_vida")
}

model ComponenteLineaVida {
  id               String                @id @default(uuid())
  inspeccionId     String
  nombre           String
  hallazgos        String?
  estado           String
  accionCorrectiva String?

  inspeccion       InspeccionLineaVida   @relation(fields: [inspeccionId], references: [id], onDelete: Cascade)
  condiciones      CondicionComponente[]

  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt

  @@index([inspeccionId])
  @@map("componentes_linea_vida")
}

model CondicionComponente {
  id           String              @id @default(uuid())
  componenteId String
  tipoAfeccion String
  descripcion  String
  estado       String
  severidad    String?             @default("media")

  componente   ComponenteLineaVida @relation(fields: [componenteId], references: [id], onDelete: Cascade)

  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  @@index([componenteId])
  @@map("condiciones_componente")
}
